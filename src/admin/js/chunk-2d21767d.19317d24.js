(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d21767d"],{c71d:function(t,e,i){"use strict";i.r(e);i("7f7f");var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"app-container"},[e("div",{staticClass:"filter-container"},[t.permission.create?e("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"filter-item",staticStyle:{"margin-left":"10px"},attrs:{type:"primary",icon:"el-icon-edit"},on:{click:function(e){t.dialogVisible=!0}}},[t._v("生成")]):t._e(),e("el-select",{staticClass:"filter-item",staticStyle:{width:"200px"},attrs:{placeholder:"基地",clearable:"",filterable:""},model:{value:t.map.factory_id,callback:function(e){t.$set(t.map,"factory_id",e)},expression:"map.factory_id"}},t._l(t.factoryList,(function(t,i){return e("el-option",{key:i,attrs:{label:t.name,value:t.id}})})),1),e("el-select",{staticClass:"filter-item",staticStyle:{width:"200px"},attrs:{placeholder:"产品",clearable:"",filterable:""},model:{value:t.map.good_id,callback:function(e){t.$set(t.map,"good_id",e)},expression:"map.good_id"}},t._l(t.goodList,(function(t,i){return e("el-option",{key:i,attrs:{label:t.name,value:t.id}})})),1),e("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"filter-item",attrs:{type:"warning",icon:"el-icon-refresh"},on:{click:t.handleFilter}},[t._v("搜索")]),t.permission.export?e("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"filter-item",staticStyle:{"margin-left":"10px"},attrs:{type:"primary",icon:"eel-icon-download",disabled:0===t.exportIds.length},on:{click:t.exportZip}},[t._v("批量导出")]):t._e()],1),e("el-table",{ref:"multipleTable",attrs:{border:"","highlight-current-row":"",data:t.tableList},on:{"selection-change":t.handleSelectionChange}},[e("el-table-column",{attrs:{type:"selection",width:"55"}}),e("el-table-column",{attrs:{align:"center",label:"ID",prop:"id",width:"100"}}),e("el-table-column",{attrs:{prop:"code",label:"包装批号"}}),e("el-table-column",{attrs:{prop:"factory.name",label:"基地名称"}}),e("el-table-column",{attrs:{prop:"good.name",label:"产品名称"}}),e("el-table-column",{attrs:{prop:"num",width:"100px",label:"生成数量"}}),e("el-table-column",{attrs:{prop:"name",label:"备注"}}),e("el-table-column",{attrs:{prop:"filename",label:"文件名称"}}),e("el-table-column",{attrs:{prop:"status_text",width:"120px",label:"是否生效"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("el-tag",{attrs:{type:0===i.row.status?"info":"success",size:"mini"}},[t._v(t._s(i.row.status_text))]),e("el-tooltip",{attrs:{content:"入库后二维码生效",placement:"top"}},[0===i.row.status?e("el-button",{staticStyle:{"margin-left":"3px"},attrs:{type:"text"},on:{click:function(e){return t.scanIn(i.row)}}},[t._v("入库")]):t._e()],1)]}}])}),e("el-table-column",{attrs:{prop:"download_num",width:"100px",label:"导出次数"}}),e("el-table-column",{attrs:{prop:"add_time",width:"200px",label:"创建时间"}}),e("el-table-column",{attrs:{label:"操作",width:"150px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("el-button-group",[t.permission.scanIn?e("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.scanIn(i.row)}}},[t._v("入库")]):t._e(),t.permission.export?e("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.confirmExportFile(i.row)}}},[t._v("导出")]):t._e(),t.permission.delete?e("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(e){return t.delItem(i.row.id)}}},[t._v("删除")]):t._e()],1)]}}])})],1),e("div",{staticClass:"pagination-container"},[e("el-pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total > 0"}],attrs:{background:"","current-page":t.page,"page-sizes":[10,15,20,50],"page-size":t.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.pageSizeChange,"current-change":t.pageChange}})],1),e("el-dialog",{attrs:{title:"生成二维码",visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("qrcode-create",{on:{success:t.handleCreateSuccess}})],1)],1)},a=[],o=(i("8e6e"),i("ac6a"),i("456d"),i("ade3")),l=function(){var t=this,e=t._self._c;return e("el-form",{ref:"newItem",attrs:{model:t.newItem,rules:t.newItemRules,"label-width":"130px"}},[e("el-form-item",{attrs:{label:"基地信息",prop:"factory_id"}},[e("el-select",{staticClass:"filter-item",staticStyle:{width:"200px"},attrs:{placeholder:"基地",clearable:"",filterable:""},model:{value:t.newItem.factory_id,callback:function(e){t.$set(t.newItem,"factory_id",e)},expression:"newItem.factory_id"}},t._l(t.factoryList,(function(t,i){return e("el-option",{key:i,attrs:{label:t.name,value:t.id}})})),1)],1),e("el-form-item",{attrs:{label:"产品信息",prop:"good_id"}},[e("el-select",{staticClass:"filter-item",staticStyle:{width:"200px"},attrs:{placeholder:"产品",clearable:"",filterable:""},model:{value:t.newItem.good_id,callback:function(e){t.$set(t.newItem,"good_id",e)},expression:"newItem.good_id"}},t._l(t.goodsList,(function(t,i){return e("el-option",{key:i,attrs:{label:t.name,value:t.id}})})),1)],1),e("el-form-item",{attrs:{label:"备注",prop:"name"}},[e("el-input",{attrs:{type:"text",autocomplete:"off"},model:{value:t.newItem.name,callback:function(e){t.$set(t.newItem,"name",e)},expression:"newItem.name"}})],1),e("el-form-item",{attrs:{label:"批次数量",prop:"batch_num"}},[e("el-input",{attrs:{type:"number",autocomplete:"off"},model:{value:t.newItem.batch_num,callback:function(e){t.$set(t.newItem,"batch_num",e)},expression:"newItem.batch_num"}}),e("div",[t._v("生成批次数量")])],1),e("el-form-item",{attrs:{label:"生成数量/每批次",prop:"num"}},[e("el-input",{attrs:{type:"number",autocomplete:"off"},model:{value:t.newItem.num,callback:function(e){t.$set(t.newItem,"num",e)},expression:"newItem.num"}}),e("div",[t._v("每批次包装（二维码）数量")])],1),e("el-form-item",{attrs:{label:" "}},[e("el-button",{attrs:{type:"primary"},on:{click:t.confirmCreateItem}},[t._v("提交")])],1)],1)},r=[],s={name:"QrcodeCreate",data:function(){return{loading:!1,newItem:{good_id:"",factory_id:"",batch_num:1,name:"",num:""},newItemRules:{good_id:[{required:!0,message:"请选择产品信息"}],num:[{required:!0,message:"每批次生成数量必填"}]},factoryList:[],goodsList:[]}},created:function(){this.getProductionList(),this.getGoodsList()},methods:{getProductionList:function(){var t=this;this.$ajax.post("/api/factory/index",{show:1}).then((function(e){t.factoryList=e}))},getGoodsList:function(){var t=this;this.$ajax.post("/api/periph/index",{show:1}).then((function(e){t.goodsList=e}))},confirmCreateItem:function(){var t=this;this.$refs.newItem.validate((function(e){if(e){if(t.loading)return;t.loading=!0,t.$ajax.post("/api/periph_qrcode/addTask",t.newItem).then((function(e){t.$emit("success"),t.$notify({title:"成功",message:"添加成功",type:"success",duration:2e3}),t.newItem={good_id:"",factory_id:"",batch_num:1,name:"",num:""}})).finally((function(){t.loading=!1}))}}))}}},c=s,p=i("2877"),d=Object(p["a"])(c,l,r,!1,null,null,null),u=d.exports;function m(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function f(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?m(Object(i),!0).forEach((function(e){Object(o["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):m(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var h={name:"PeriphQrcodeIndex",components:{QrcodeCreate:u},data:function(){return{permission:{create:this.$checkAuth("PeriphQrcodeCreate"),export:this.$checkAuth("PeriphQrcodeExport"),delete:this.$checkAuth("PeriphQrcodeDelete"),scanIn:this.$checkAuth("PeriphQrcodeScanin")},page:1,pageSize:10,total:0,tableList:[],exportIds:[],map:{},loading:!1,exportLoading:!1,dialogVisible:!1,factoryList:[],goodList:[]}},created:function(){this.getList(),this.getFactoryList(),this.getGoodList()},methods:{scanIn:function(t){var e=this;this.$confirm("入库后二维码生效","提示",{confirmButtonText:"确定入库",cancelButtonText:"取消",type:"warning"}).then((function(){e.$ajax.post("/api/periph_qrcode/scanIn",{id:t.id}).then((function(t){e.$message.success("入库成功"),e.getList()})).catch((function(){e.$message.error("入库失败")}))}))},handleSelectionChange:function(t){var e=t.map((function(t){return t.id}));this.exportIds=e},getFactoryList:function(){var t=this;this.periphList&&this.periphList.length>0||this.$ajax.post("/api/factory/index",{show:1}).then((function(e){t.factoryList=e}))},getGoodList:function(){var t=this;this.goodList&&this.goodList.length>0||this.$ajax.post("/api/periph/index",{show:1}).then((function(e){t.goodList=e}))},exportZip:function(){var t=this;this.$confirm("批量导出二维码时，请确认无重复印刷？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$ajax.post("/api/periph_qrcode/download",{id:t.exportIds}).then((function(e){t.getList(),t.exportFile(e.filename,e.download_url),t.exportIds=[],t.$refs.multipleTable.clearSelection()})).catch((function(){t.$message.error("导出失败")}))}))},confirmExportFile:function(t){var e=this,i=t.download_num>0?"二维码已导出"+t.download_num+"次！确认无重复印刷？":"确定导出该二维码？";this.$confirm(i,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.$ajax.post("/api/periph_qrcode/download",{id:t.id}).then((function(){e.exportFile(t.filename,t.download_url),e.getList()})).catch((function(){e.$message.error("导出失败")}))}))},exportFile:function(t,e){var i=document.createElement("a");i.style.display="none",i.setAttribute("target","_blank"),i.setAttribute("download",t),i.href=e,document.body.appendChild(i),i.click(),document.body.removeChild(i)},handleCreateSuccess:function(){this.dialogVisible=!1,this.getList()},getList:function(){var t=this;this.loading=!0,this.$ajax.post("/api/periph_qrcode/task",f({page:this.page,pageSize:this.pageSize},this.map)).then((function(e){t.loading=!1,t.tableList=e.data,t.total=e.total})).catch((function(){t.loading=!1}))},pageSizeChange:function(t){this.pageSize=t,this.getList()},pageChange:function(t){this.page=t,this.getList()},handleFilter:function(){this.page=1,this.getList()},delItem:function(t){var e=this;this.$confirm("此操作将永久删除该文件, 是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.$ajax.post("/api/periph_qrcode/delTask/id/"+t).then((function(t){e.$notify({title:"成功",message:"删除成功",type:"success",duration:2e3}),e.getList()}))}))}}},g=h,b=Object(p["a"])(g,n,a,!1,null,"0c19b975",null);e["default"]=b.exports}}]);