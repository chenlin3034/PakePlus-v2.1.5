(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d22fcd3"],{ea23:function(e,t,n){"use strict";n.r(t);n("7f7f");var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"app-container"},[t("div",{staticClass:"filter-container"},[e.permission.create?t("el-button",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"filter-item",staticStyle:{"margin-left":"10px"},attrs:{type:"primary",icon:"el-icon-edit"},on:{click:function(t){e.dialogVisible=!0}}},[e._v("生成")]):e._e(),e.productionList.length>0?t("el-select",{staticClass:"filter-item",staticStyle:{width:"200px"},attrs:{placeholder:"工厂",clearable:"",filterable:""},model:{value:e.map.production_id,callback:function(t){e.$set(e.map,"production_id",t)},expression:"map.production_id"}},e._l(e.productionList,(function(e,n){return t("el-option",{key:n,attrs:{label:e.name,value:e.id}})})),1):e._e(),t("el-button",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"filter-item",attrs:{type:"warning",icon:"el-icon-refresh"},on:{click:e.handleFilter}},[e._v("搜索")]),e.permission.export?t("el-button",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"filter-item",staticStyle:{"margin-left":"10px"},attrs:{type:"primary",icon:"eel-icon-download",disabled:0===e.exportIds.length},on:{click:e.exportZip}},[e._v("批量导出")]):e._e()],1),t("el-table",{ref:"multipleTable",attrs:{border:"","highlight-current-row":"",data:e.tableList},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"55"}}),t("el-table-column",{attrs:{align:"center",label:"ID",prop:"id",width:"100"}}),t("el-table-column",{attrs:{prop:"code",label:"加工批号"}}),t("el-table-column",{attrs:{prop:"production.name",label:"工厂"}}),t("el-table-column",{attrs:{prop:"good.name",label:"品规"}}),t("el-table-column",{attrs:{prop:"num",width:"100px",label:"生成数量"}}),t("el-table-column",{attrs:{prop:"name",label:"备注"}}),t("el-table-column",{attrs:{prop:"filename",label:"文件名称"}}),t("el-table-column",{attrs:{prop:"download_num",width:"100px",label:"导出次数"}}),t("el-table-column",{attrs:{prop:"add_time",width:"200px",label:"创建时间"}}),t("el-table-column",{attrs:{label:"操作",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("el-button-group",[e.permission.export?t("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.confirmExportFile(n.row)}}},[e._v("导出")]):e._e(),e.permission.delete?t("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(t){return e.delItem(n.row.id)}}},[e._v("删除")]):e._e()],1)]}}])})],1),t("div",{staticClass:"pagination-container"},[t("el-pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],attrs:{background:"","current-page":e.page,"page-sizes":[10,15,20,50],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.pageSizeChange,"current-change":e.pageChange}})],1),t("el-dialog",{attrs:{title:"生成二维码",visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("qrcode-create",{on:{success:e.handleCreateSuccess}})],1)],1)},o=[],a=(n("8e6e"),n("ac6a"),n("456d"),n("ade3")),r=function(){var e=this,t=e._self._c;return t("el-form",{ref:"newItem",attrs:{model:e.newItem,rules:e.newItemRules,"label-width":"130px"}},[t("el-form-item",{attrs:{label:"工厂",prop:"production_id"}},[t("el-select",{attrs:{placeholder:"请选择工厂"},model:{value:e.newItem.production_id,callback:function(t){e.$set(e.newItem,"production_id",t)},expression:"newItem.production_id"}},e._l(e.productionList,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),t("el-form-item",{attrs:{label:"品种信息",prop:"good_id"}},[t("el-cascader",{attrs:{options:e.goodsList,props:{value:"id",label:"name",emitPath:!1}},model:{value:e.newItem.good_id,callback:function(t){e.$set(e.newItem,"good_id",t)},expression:"newItem.good_id"}})],1),t("el-form-item",{attrs:{label:"备注",prop:"name"}},[t("el-input",{attrs:{type:"text",autocomplete:"off"},model:{value:e.newItem.name,callback:function(t){e.$set(e.newItem,"name",t)},expression:"newItem.name"}})],1),t("el-form-item",{attrs:{label:"批次数量",prop:"batch_num"}},[t("el-input",{attrs:{type:"number",autocomplete:"off"},model:{value:e.newItem.batch_num,callback:function(t){e.$set(e.newItem,"batch_num",t)},expression:"newItem.batch_num"}}),t("div",[e._v("生成批次数量")])],1),t("el-form-item",{attrs:{label:"生成数量/每批次",prop:"num"}},[t("el-input",{attrs:{type:"number",autocomplete:"off"},model:{value:e.newItem.num,callback:function(t){e.$set(e.newItem,"num",t)},expression:"newItem.num"}}),t("div",[e._v("每批次包装（二维码）数量")])],1),t("el-form-item",{attrs:{label:" "}},[t("el-button",{attrs:{type:"primary"},on:{click:e.confirmCreateItem}},[e._v("提交")])],1)],1)},l=[],s={name:"QrcodeCreate",data:function(){return{loading:!1,newItem:{good_id:"",production_id:"",batch_num:1,name:"",num:""},newItemRules:{good_id:[{required:!0,message:"请选择品种信息"}],production_id:[{required:!0,message:"请选择工厂"}],num:[{required:!0,message:"每批次生成数量必填"}]},productionList:[],goodsList:[]}},created:function(){this.getProductionList(),this.getGoodsList()},methods:{getProductionList:function(){var e=this;this.$ajax.post("/api/production/index",{pageSize:1e3}).then((function(t){e.productionList=t.data}))},getGoodsList:function(){var e=this;this.$ajax.post("/api/good/getTreeList").then((function(t){e.goodsList=t}))},confirmCreateItem:function(){var e=this;this.$refs.newItem.validate((function(t){if(t){if(e.loading)return;e.loading=!0,e.$ajax.post("/api/qrcode/addTask",e.newItem).then((function(t){e.$emit("success"),e.$notify({title:"成功",message:"添加成功",type:"success",duration:2e3}),e.newItem={good_id:"",batch_num:1,name:"",num:""}})).finally((function(){e.loading=!1}))}}))}}},c=s,d=n("2877"),u=Object(d["a"])(c,r,l,!1,null,null,null),p=u.exports;function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){Object(a["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var g={name:"QrcodeIndex",components:{QrcodeCreate:p},data:function(){return{permission:{create:this.$checkAuth("QrcodeCreate"),export:this.$checkAuth("QrcodeExport"),delete:this.$checkAuth("QrcodeDelete")},page:1,pageSize:10,total:0,tableList:[],exportIds:[],map:{},loading:!1,exportLoading:!1,dialogVisible:!1,productionList:[]}},created:function(){this.getList(),this.getProductionList()},methods:{handleSelectionChange:function(e){var t=e.map((function(e){return e.id}));this.exportIds=t},getProductionList:function(){var e=this;this.productionList&&this.productionList.length>0||this.$ajax.post("/api/production/index",{show:1}).then((function(t){e.productionList=t}))},exportZip:function(){var e=this;this.$confirm("批量导出二维码时，请确认无重复印刷？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.$ajax.post("/api/qrcode/download",{id:e.exportIds}).then((function(t){e.getList(),e.exportFile(t.filename,t.download_url),e.exportIds=[],e.$refs.multipleTable.clearSelection()})).catch((function(){e.$message.error("导出失败")}))}))},confirmExportFile:function(e){var t=this,n=e.download_num>0?"二维码已导出"+e.download_num+"次！确认无重复印刷？":"确定导出该二维码？";this.$confirm(n,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$ajax.post("/api/qrcode/download",{id:e.id}).then((function(){t.exportFile(e.filename,e.download_url),t.getList()})).catch((function(){t.$message.error("导出失败")}))}))},exportFile:function(e,t){var n=document.createElement("a");n.style.display="none",n.setAttribute("target","_blank"),n.setAttribute("download",e),n.href=t,document.body.appendChild(n),n.click(),document.body.removeChild(n)},handleCreateSuccess:function(){this.dialogVisible=!1,this.getList()},getList:function(){var e=this;this.loading=!0,this.$ajax.post("/api/qrcode/task",f({page:this.page,pageSize:this.pageSize},this.map)).then((function(t){e.loading=!1,e.tableList=t.data,e.total=t.total})).catch((function(){e.loading=!1}))},pageSizeChange:function(e){this.pageSize=e,this.getList()},pageChange:function(e){this.page=e,this.getList()},handleFilter:function(){this.page=1,this.getList()},delItem:function(e){var t=this;this.$confirm("此操作将永久删除该文件, 是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$ajax.post("/api/qrcode/delTask/id/"+e).then((function(e){t.$notify({title:"成功",message:"删除成功",type:"success",duration:2e3}),t.getList()}))}))}}},h=g,b=Object(d["a"])(h,i,o,!1,null,"7c435704",null);t["default"]=b.exports}}]);