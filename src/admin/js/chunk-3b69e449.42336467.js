(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3b69e449"],{"3b85":function(t,e,a){"use strict";a.r(e);a("7f7f");var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"app-container"},[e("div",{staticClass:"filter-container"},[t.permission.create?e("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"filter-item",staticStyle:{"margin-left":"10px"},attrs:{type:"primary",icon:"el-icon-edit"},on:{click:t.handleCreate}},[t._v("添加出库单")]):t._e(),e("el-input",{staticClass:"filter-item",staticStyle:{width:"250px"},attrs:{clearable:"",placeholder:"出库单号/种子批号/客户号"},model:{value:t.map.keyword,callback:function(e){t.$set(t.map,"keyword",e)},expression:"map.keyword"}}),t.productionList.length>0?e("el-select",{staticClass:"filter-item",staticStyle:{width:"200px"},attrs:{placeholder:"工厂",clearable:"",filterable:""},model:{value:t.map.production_id,callback:function(e){t.$set(t.map,"production_id",e)},expression:"map.production_id"}},t._l(t.productionList,(function(t,a){return e("el-option",{key:a,attrs:{label:t.name,value:t.id}})})),1):t._e(),e("el-select",{staticClass:"filter-item",attrs:{clearable:"",placeholder:"出库类型"},model:{value:t.map.type,callback:function(e){t.$set(t.map,"type",e)},expression:"map.type"}},t._l(t.typeList,(function(t,a){return e("el-option",{key:a,attrs:{label:t.label,value:t.value}})})),1),e("el-select",{staticClass:"filter-item",attrs:{clearable:"",placeholder:"状态"},model:{value:t.map.status,callback:function(e){t.$set(t.map,"status",e)},expression:"map.status"}},t._l(t.statusList,(function(t,a){return e("el-option",{key:a,attrs:{label:t.label,value:t.value}})})),1),e("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.handleFilter}},[t._v("搜索")]),e("el-dropdown",{staticClass:"filter-item",attrs:{trigger:"click",disabled:t.exportLoading},on:{command:t.exportExcel}},[e("el-button",{attrs:{type:"primary"}},[t._v("\n        导出"),e("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("el-dropdown-item",{attrs:{command:0}},[t._v("导出本页")]),e("el-dropdown-item",{attrs:{command:1}},[t._v("导出全部")])],1)],1)],1),e("el-table",{attrs:{border:"","highlight-current-row":"",data:t.tableList}},[e("el-table-column",{attrs:{align:"center",label:"ID",prop:"id",width:"60"}}),e("el-table-column",{attrs:{prop:"code",label:"出库单号",width:"120"}}),e("el-table-column",{attrs:{prop:"production.name",label:"工厂/渠道商"},scopedSlots:t._u([{key:"default",fn:function(a){return[a.row.production?e("span",[t._v(t._s(a.row.production.code+"("+a.row.production.name+")"))]):e("span",[t._v(t._s(a.row.from.code+"("+a.row.from.name+")"))])]}}])}),e("el-table-column",{attrs:{prop:"batch_code",label:"批号",width:"90"}}),e("el-table-column",{attrs:{prop:"custom_code",label:"客户"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",[t._v(t._s(a.row.custom?a.row.custom.code+"("+a.row.custom.name+")":"-"))])]}}])}),e("el-table-column",{attrs:{prop:"qrcode_count",label:"二维码数量",width:"95px"}}),e("el-table-column",{attrs:{prop:"express.car_mobile",label:"司机电话",width:"110px"}}),e("el-table-column",{attrs:{prop:"express.car_sn",label:"车牌号",width:"100px"}}),e("el-table-column",{attrs:{prop:"express.to_time",label:"收货时间",width:"95px"}}),e("el-table-column",{attrs:{prop:"images",label:"出库照片",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(a){return[a.row.express&&a.row.express.images?e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.lookCarImages(a.row.express)}}},[t._v("查看")]):t._e()]}}])}),e("el-table-column",{attrs:{prop:"create_time",label:"创建时间",width:"160px"}}),e("el-table-column",{attrs:{prop:"status_text",label:"状态",width:"120px"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",{staticStyle:{"margin-right":"10px"}},[t._v(t._s(a.row.status_text))]),e("el-dropdown",{on:{command:t.changeStatus}},[e("el-button",{attrs:{type:"text"}},[t._v("修改")]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("el-dropdown-item",{attrs:{command:{id:a.row.id,status:"0"},disabled:"0"===a.row.status}},[t._v("待出库")]),e("el-dropdown-item",{attrs:{command:{id:a.row.id,status:"1"},disabled:"1"===a.row.status}},[t._v("已出库")]),e("el-dropdown-item",{attrs:{command:{id:a.row.id,status:"2"},disabled:"2"===a.row.status}},[t._v("已完成")])],1)],1)]}}])}),e("el-table-column",{attrs:{label:"操作",width:"180px"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button-group",[t.permission.edit?e("el-button",{attrs:{type:"warning",size:"small"},on:{click:function(e){return t.handleEdit(a.row)}}},[t._v("编辑")]):t._e(),t.permission.delete?e("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(e){return t.deleteItem(a.row.id)}}},[t._v("删除")]):t._e()],1)]}}])})],1),e("div",{staticClass:"pagination-container"},[e("el-pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total > 0"}],attrs:{background:"","current-page":t.page,"page-sizes":[10,15,20,50],"page-size":t.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.pageSizeChange,"current-change":t.pageChange}})],1),e("el-dialog",{attrs:{title:"出库照片",visible:t.showExpreeeImages},on:{"update:visible":function(e){t.showExpreeeImages=e}}},t._l(t.currentExpressImages,(function(a,i){return e("el-image",{key:i,staticStyle:{width:"200px",height:"300px","margin-right":"10px"},attrs:{fit:"cover",src:a,"preview-src-list":t.currentExpressImages}})})),1),e("el-dialog",{attrs:{title:"出库信息",visible:t.addDialogVisible},on:{"update:visible":function(e){t.addDialogVisible=e}}},[e("el-form",{ref:"newItem",attrs:{model:t.newItem,rules:t.newItemRules,"label-width":"100px"}},[e("el-form-item",{attrs:{label:"客户号",prop:"custom_code"}},[e("el-autocomplete",{staticStyle:{width:"100%"},attrs:{type:"text","fetch-suggestions":t.customQuerySearchAsync,autocomplete:"off"},on:{select:t.customHandleSelect},model:{value:t.newItem.custom_name,callback:function(e){t.$set(t.newItem,"custom_name",e)},expression:"newItem.custom_name"}})],1),e("el-form-item",{attrs:{label:"种子批",prop:"batch_code"}},[e("el-input",{attrs:{type:"text",placeholder:"种子批号",autocomplete:"off"},on:{input:t.handleBatchInput},model:{value:t.newItem.batch_code,callback:function(e){t.$set(t.newItem,"batch_code",e)},expression:"newItem.batch_code"}})],1),e("el-form-item",{attrs:{label:"生产工厂",prop:"production_id"}},[e("el-input",{attrs:{readonly:"",type:"text",placeholder:"输入种子批号自动选择生产工厂",autocomplete:"off"},model:{value:t.newItem.production_name,callback:function(e){t.$set(t.newItem,"production_name",e)},expression:"newItem.production_name"}})],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.addDialogVisible=!1}}},[t._v("取 消")]),e("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{type:"primary"},on:{click:t.confirmCreateItem}},[t._v("确 定")])],1)],1),e("el-dialog",{attrs:{title:"出库信息",visible:t.batchDialogVisible,width:"70%"},on:{"update:visible":function(e){t.batchDialogVisible=e}}},[t.batchDialogVisible?e("out-batch",{attrs:{out_id:t.currentOutId}}):t._e()],1)],1)},n=[],o=(a("8e6e"),a("ac6a"),a("456d"),a("ade3")),s=(a("96cf"),a("1da1")),r=a("0e0b"),l=function(){var t=this,e=t._self._c;return e("div",{staticClass:"app-container"},[e("div",{staticClass:"filter-container"},[e("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"filter-item",staticStyle:{"margin-left":"10px"},attrs:{type:"primary",icon:"el-icon-edit"},on:{click:t.handleCreate}},[t._v("添加批号")]),e("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"filter-item float-right",attrs:{type:"warning",icon:"el-icon-refresh"},on:{click:t.getList}},[t._v("刷新")])],1),e("el-table",{attrs:{border:"","highlight-current-row":"",data:t.tableList}},[e("el-table-column",{attrs:{align:"center",label:"ID",prop:"id",width:"100"}}),e("el-table-column",{attrs:{prop:"batch.name",label:"备注"}}),e("el-table-column",{attrs:{prop:"batch_code",label:"批号"}}),e("el-table-column",{attrs:{prop:"batch.good.name",label:"品种信息"}}),e("el-table-column",{attrs:{prop:"batch.status_name",label:"状态"}}),e("el-table-column",{attrs:{prop:"create_time",label:"创建时间"}}),e("el-table-column",{attrs:{label:"操作",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button-group",{staticStyle:{"margin-top":"5px"}},[e("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(e){return t.deleteItem(a.row.id)}}},[t._v("删除")])],1)]}}])})],1),e("div",{staticClass:"pagination-container"},[e("el-pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total > 0"}],attrs:{background:"","current-page":t.page,"page-size":t.pageSize,layout:"total, prev, pager, next, jumper",total:t.total},on:{"current-change":t.pageChange}})],1),e("el-dialog",{attrs:{title:"添加批号",visible:t.addDialogVisible,"append-to-body":""},on:{"update:visible":function(e){t.addDialogVisible=e}}},[e("el-form",{ref:"newItem",attrs:{model:t.newItem,rules:t.newItemRules,"label-width":"100px"}},[e("el-form-item",{attrs:{label:"批号",prop:"batch_code"}},[e("el-input",{attrs:{type:"text",autocomplete:"off"},model:{value:t.newItem.batch_code,callback:function(e){t.$set(t.newItem,"batch_code",e)},expression:"newItem.batch_code"}})],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.addDialogVisible=!1}}},[t._v("取 消")]),e("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{type:"primary"},on:{click:t.confirmCreateItem}},[t._v("确 定")])],1)],1)],1)},c=[],u={props:{out_id:""},data:function(){return{permission:{qrcode:!1,good:!1,out:!1},loading:!1,tableList:[],page:1,pageSize:10,total:0,addDialogVisible:!1,newItem:{},newItemRules:{batch_code:[{required:!0,message:"请输入批号",trigger:"blur"}]}}},created:function(){this.getList()},methods:{deleteItem:function(t){var e=this;this.$confirm("删除后不可恢复, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.loading||(e.loading=!0,e.$ajax.post("/api/out/deleteBatchList",{id:t,out_id:e.out_id}).then((function(t){e.$notify({title:"成功",message:"删除成功",type:"success",duration:2e3}),e.getList()})).finally((function(){e.loading=!1})))}))},handleCreate:function(){this.newItem={},this.addDialogVisible=!0},confirmCreateItem:function(){var t=this;this.$refs.newItem.validate((function(e){e&&t.addItem()}))},addItem:function(){var t=this;this.loading||(this.loading=!0,this.$ajax.post("/api/out/addBatch/id/"+this.out_id,this.newItem).then((function(e){t.$notify({title:"成功",message:"添加成功",type:"success",duration:2e3}),t.addDialogVisible=!1,t.getList()})).finally((function(){t.loading=!1})))},getList:function(){var t=this;this.loading=!0,this.$ajax.get("/api/out/getBatchList?out_id="+this.out_id+"&page="+this.page).then((function(e){t.tableList=e.data,t.total=e.total})).finally((function(){t.loading=!1}))},pageChange:function(t){this.page=t,this.getList()}}},d=u,p=a("2877"),m=Object(p["a"])(d,l,c,!1,null,null,null),h=m.exports;function g(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function f(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?g(Object(a),!0).forEach((function(e){Object(o["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):g(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var b={name:"OutIndex",components:{OutBatch:h},data:function(){return{permission:{create:this.$checkAuth("BatchOutCreate"),delete:this.$checkAuth("BatchOutDelete"),batch:this.$checkAuth("BatchOutBatch"),edit:this.$checkAuth("BatchOutEdit")},page:1,pageSize:10,total:0,tableList:[],map:{},loading:!1,exportLoading:!1,addDialogVisible:!1,batchDialogVisible:!1,currentOutId:"",productionList:[],batchInputTimer:null,showExpreeeImages:!1,currentExpressImages:[],statusList:[{label:"待出库",value:"0"},{label:"已出库",value:"1"},{label:"已完成",value:"2"}],typeList:[{label:"工厂出库",value:"0"},{label:"渠道商出库",value:"1"}],newItem:{custom_code:"",production_id:"",batch_code:""},newItemRules:{custom_code:[{required:!0,message:"请输入客户号"}],production_id:[{required:!0,message:"请选择生产工厂"}],batch_code:[{required:!0,message:"请输入种子批号"}]}}},created:function(){this.getList(),this.getProductionList()},methods:{lookCarImages:function(t){t&&0!==t.images_list.length?(this.currentExpressImages=t.images_list,this.showExpreeeImages=!0):this.$message.error("无照片")},handleBatchInput:function(t){var e=this;t&&(this.batchInputTimer&&(clearTimeout(this.batchInputTimer),this.batchInputTimer=null),this.batchInputTimer=setTimeout((function(){e.$ajax.post("/api/production/detail",{batch_code:t}).then((function(t){if(!t||!t.id)return e.$set(e.newItem,"production_name",""),void e.$set(e.newItem,"production_id","");e.$set(e.newItem,"production_name",t.name),e.$set(e.newItem,"production_id",t.id)}))}),500))},customHandleSelect:function(t){this.$set(this.newItem,"custom_code",t.code)},customQuerySearchAsync:function(t,e){t?this.$ajax.get("/api/custom/index",{params:{tree:0,keyword:t,pageSize:10}}).then((function(t){var a=t.data.map((function(t){return{value:t.code+"("+t.name+")",code:t.code}}));e(a)})):e([])},changeStatus:function(t){var e=this;this.$ajax.post("/api/out/updateStatus",t).then((function(){e.$message.success("修改成功"),e.getList()}))},handleCreate:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.getProductionList();case 2:this.newItem={custom_code:"",production_id:"",batch_code:""},this.addDialogVisible=!0;case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),confirmCreateItem:function(){var t=this;this.$refs.newItem.validate((function(e){e&&(t.newItem.id?t.editItem():t.addItem())}))},handleEdit:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.getProductionList();case 2:this.newItem={id:e.id,custom_code:e.custom_code,production_id:e.production_id>0?e.production_id:"",batch_code:e.batch_code},this.addDialogVisible=!0;case 4:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),getProductionList:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!(this.productionList&&this.productionList.length>0)){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,this.$ajax.post("/api/production/index",{show:1});case 4:e=t.sent,this.productionList=e;case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),getList:function(){var t=this;this.loading=!0,this.$ajax.post("/api/out/index",f({page:this.page,pageSize:this.pageSize},this.map)).then((function(e){t.loading=!1,t.tableList=e.data,t.total=e.total})).catch((function(){t.loading=!1}))},pageSizeChange:function(t){this.pageSize=t,this.getList()},pageChange:function(t){this.page=t,this.getList()},handleFilter:function(){this.page=1,this.getList()},deleteItem:function(t){var e=this;this.$confirm("此操作将永久删除该品种, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.loading||(e.loading=!0,e.$ajax.post("/api/out/delete/id/"+t).then((function(t){e.$notify({title:"成功",message:"删除成功",type:"success",duration:2e3}),e.getList()})).finally((function(){e.loading=!1})))}))},editItem:function(){var t=this;this.loading||(this.loading=!0,this.$ajax.post("/api/out/update/id/"+this.newItem.id,this.newItem).then((function(e){t.$notify({title:"成功",message:"编辑成功",type:"success",duration:2e3}),t.addDialogVisible=!1,t.getList()})).finally((function(){t.loading=!1})))},addItem:function(){var t=this;this.loading||(this.loading=!0,this.$ajax.post("/api/out/add",this.newItem).then((function(e){t.$notify({title:"成功",message:"添加成功",type:"success",duration:2e3}),t.addDialogVisible=!1,t.getList()})).finally((function(){t.loading=!1})))},exportExcel:function(t){var e=this;if(!this.exportLoading){this.exportLoading=!0;var a=1===t?"10000":this.pageSize,i=1===t?1:this.page;this.$ajax.post("/api/out/index",f({page:i,pageSize:a},this.map)).then((function(t){var a=["出库单号","工厂","批号","客户","二维码数量","司机电话","车牌号","出库照片","收货时间","创建时间","状态"],i=t.data.map((function(t){return[t.code,t.production?t.production.name:"",t.factory?t.factory.name:"",t.custom?t.custom.code+"("+t.custom.name+")":"",t.qrcode_count,t.express?t.express.car_mobile:"",t.express?t.express.car_sn:"",t.express&&t.express.images_list.length>0?t.express.images_list.join(","):"",t.express?t.express.to_time:"",t.create_time,t.status_text]}));Object(r["a"])({header:a,data:i,filename:"出库单信息"}).finally((function(){e.exportLoading=!1}))})).catch((function(){e.exportLoading=!1}))}}}},w=b,v=(a("954f"),Object(p["a"])(w,i,n,!1,null,"703a1428",null));e["default"]=v.exports},"7ed0":function(t,e,a){},"954f":function(t,e,a){"use strict";a("7ed0")}}]);