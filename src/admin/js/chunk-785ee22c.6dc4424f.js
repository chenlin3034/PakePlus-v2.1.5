(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-785ee22c"],{"0a49":function(e,t,i){var a=i("9b43"),n=i("626a"),r=i("4bf8"),o=i("9def"),s=i("cd1c");e.exports=function(e,t){var i=1==e,c=2==e,l=3==e,d=4==e,u=6==e,f=5==e||u,p=t||s;return function(t,s,h){for(var g,m,v=r(t),b=n(v),y=a(s,h,3),w=o(b.length),x=0,_=i?p(t,w):c?p(t,0):void 0;w>x;x++)if((f||x in b)&&(g=b[x],m=y(g,x,v),e))if(i)_[x]=m;else if(m)switch(e){case 3:return!0;case 5:return g;case 6:return x;case 2:_.push(g)}else if(d)return!1;return u?-1:l||d?d:_}}},"20d6":function(e,t,i){"use strict";var a=i("5ca1"),n=i("0a49")(6),r="findIndex",o=!0;r in[]&&Array(1)[r]((function(){o=!1})),a(a.P+a.F*o,"Array",{findIndex:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}}),i("9c6c")(r)},"28a5":function(e,t,i){"use strict";var a=i("aae3"),n=i("cb7c"),r=i("ebd6"),o=i("0390"),s=i("9def"),c=i("5f1b"),l=i("520a"),d=i("79e5"),u=Math.min,f=[].push,p="split",h="length",g="lastIndex",m=4294967295,v=!d((function(){RegExp(m,"y")}));i("214f")("split",2,(function(e,t,i,d){var b;return b="c"=="abbc"[p](/(b)*/)[1]||4!="test"[p](/(?:)/,-1)[h]||2!="ab"[p](/(?:ab)*/)[h]||4!="."[p](/(.?)(.?)/)[h]||"."[p](/()()/)[h]>1||""[p](/.?/)[h]?function(e,t){var n=String(this);if(void 0===e&&0===t)return[];if(!a(e))return i.call(n,e,t);var r,o,s,c=[],d=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),u=0,p=void 0===t?m:t>>>0,v=new RegExp(e.source,d+"g");while(r=l.call(v,n)){if(o=v[g],o>u&&(c.push(n.slice(u,r.index)),r[h]>1&&r.index<n[h]&&f.apply(c,r.slice(1)),s=r[0][h],u=o,c[h]>=p))break;v[g]===r.index&&v[g]++}return u===n[h]?!s&&v.test("")||c.push(""):c.push(n.slice(u)),c[h]>p?c.slice(0,p):c}:"0"[p](void 0,0)[h]?function(e,t){return void 0===e&&0===t?[]:i.call(this,e,t)}:i,[function(i,a){var n=e(this),r=void 0==i?void 0:i[t];return void 0!==r?r.call(i,n,a):b.call(String(n),i,a)},function(e,t){var a=d(b,e,this,t,b!==i);if(a.done)return a.value;var l=n(e),f=String(this),p=r(l,RegExp),h=l.unicode,g=(l.ignoreCase?"i":"")+(l.multiline?"m":"")+(l.unicode?"u":"")+(v?"y":"g"),y=new p(v?l:"^(?:"+l.source+")",g),w=void 0===t?m:t>>>0;if(0===w)return[];if(0===f.length)return null===c(y,f)?[f]:[];var x=0,_=0,O=[];while(_<f.length){y.lastIndex=v?_:0;var I,S=c(y,v?f:f.slice(_));if(null===S||(I=u(s(y.lastIndex+(v?0:_)),f.length))===x)_=o(f,_,h);else{if(O.push(f.slice(x,_)),O.length===w)return O;for(var k=1;k<=S.length-1;k++)if(O.push(S[k]),O.length===w)return O;_=x=I}}return O.push(f.slice(x)),O}]}))},"321f":function(e,t,i){"use strict";i("57c3")},"57c3":function(e,t,i){},7972:function(e,t,i){"use strict";i("ffcd")},aa77:function(e,t,i){var a=i("5ca1"),n=i("be13"),r=i("79e5"),o=i("fdef"),s="["+o+"]",c="​",l=RegExp("^"+s+s+"*"),d=RegExp(s+s+"*$"),u=function(e,t,i){var n={},s=r((function(){return!!o[e]()||c[e]()!=c})),l=n[e]=s?t(f):o[e];i&&(n[i]=l),a(a.P+a.F*s,"String",n)},f=u.trim=function(e,t){return e=String(n(e)),1&t&&(e=e.replace(l,"")),2&t&&(e=e.replace(d,"")),e};e.exports=u},c5f6:function(e,t,i){"use strict";var a=i("7726"),n=i("69a8"),r=i("2d95"),o=i("5dbc"),s=i("6a99"),c=i("79e5"),l=i("9093").f,d=i("11e9").f,u=i("86cc").f,f=i("aa77").trim,p="Number",h=a[p],g=h,m=h.prototype,v=r(i("2aeb")(m))==p,b="trim"in String.prototype,y=function(e){var t=s(e,!1);if("string"==typeof t&&t.length>2){t=b?t.trim():f(t,3);var i,a,n,r=t.charCodeAt(0);if(43===r||45===r){if(i=t.charCodeAt(2),88===i||120===i)return NaN}else if(48===r){switch(t.charCodeAt(1)){case 66:case 98:a=2,n=49;break;case 79:case 111:a=8,n=55;break;default:return+t}for(var o,c=t.slice(2),l=0,d=c.length;l<d;l++)if(o=c.charCodeAt(l),o<48||o>n)return NaN;return parseInt(c,a)}}return+t};if(!h(" 0o1")||!h("0b1")||h("+0x1")){h=function(e){var t=arguments.length<1?0:e,i=this;return i instanceof h&&(v?c((function(){m.valueOf.call(i)})):r(i)!=p)?o(new g(y(t)),i,h):y(t)};for(var w,x=i("9e1e")?l(g):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),_=0;x.length>_;_++)n(g,w=x[_])&&!n(h,w)&&u(h,w,d(g,w));h.prototype=m,m.constructor=h,i("2aba")(a,p,h)}},cd1c:function(e,t,i){var a=i("e853");e.exports=function(e,t){return new(a(e))(t)}},d6f0:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e._self._c;return t("div",[t("el-row",[t("el-col",{attrs:{xs:24,sm:12}},[t("div",{staticClass:"tip"},[t("div",{staticClass:"tip-title"},[e._v("操作说明:")]),t("p",[e._v("一：扫码枪扫码添加")]),t("p",[e._v("1.确认扫码枪和电脑连接正常")]),t("p",[e._v("2.使用扫码枪对准二维码进行扫描")]),t("p",[e._v("3.扫描成功后自动入库")]),t("p",[e._v("二：手动添加")]),t("p",[e._v("1.输入二维码连接或单元识别代码")]),t("p",[e._v("2.按键盘回车键添加入库")])])]),t("el-col",{attrs:{xs:24,sm:12}},[t("el-form",{ref:"newItem",attrs:{"label-width":"100px"}},[t("el-form-item",{attrs:{label:"批号",prop:"code"}},[t("el-input",{staticStyle:{width:"250px"},attrs:{disabled:""},model:{value:e.code,callback:function(t){e.code=t},expression:"code"}})],1),t("el-form-item",{attrs:{label:"单元识别代码"}},[t("el-input",{ref:"qrcodeRef",staticStyle:{width:"250px"},attrs:{type:"text",placeholder:"扫码二维码"},on:{change:e.qrcodeChange,blur:e.qrcodeBlur},model:{value:e.qrcode,callback:function(t){e.qrcode=t},expression:"qrcode"}}),t("div",{staticClass:"msg"},[e._v("请先点击输入框，再扫描二维码")])],1)],1)],1)],1),t("el-divider",[e._v("批量添加（加工批号）")]),t("el-row",[t("el-col",{attrs:{xs:24,sm:12}},[t("div",{staticClass:"tip"},[t("div",{staticClass:"tip-title"},[e._v("操作说明:")]),t("p",[e._v("1.选择加工批号")]),t("p",[e._v("2.只可选择与本批号相同工厂的加工批号")]),t("p",[e._v("3.每个加工批号只可关联一次")]),t("p",[e._v("4.如有重复二维码，则会替换原数据，请确认加工批号内二维码未被扫码入库，否则将删除原批号内二维码")]),t("p",[e._v("5.如批号未关联品规，将自动关联加工批号品规信息")])])]),t("el-col",{attrs:{xs:24,sm:12}},[t("div",{staticClass:"tip"},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.showQrcodeTaskListDialog=!0}}},[e._v("选择加工批号")])],1)])],1),t("el-divider",[e._v("批量添加（上传文件）")]),t("el-row",[t("el-col",{attrs:{xs:24,sm:12}},[t("div",{staticClass:"tip"},[t("div",{staticClass:"tip-title"},[e._v("操作说明:")]),t("p",[e._v("一：上传包装二维码文件")]),t("p",[e._v("1.上传包装制作二维码导出的txt文件")]),t("p",[e._v("2.如有重复二维码，则会替换原数据，请确认批号相同，否则将删除原批号内二维码")])])]),t("el-col",{attrs:{xs:24,sm:12}},[t("el-form",{ref:"newFileItem",attrs:{"label-width":"100px"}},[t("el-form-item",{attrs:{label:"上传文件"}},[t("upload",{attrs:{drag:!0,showLoading:!0,accept:".txt",action:"/api/batch/addQrcodeByFile",data:{batch_id:e.batch_id,code:e.code}},on:{"on-change":e.fileChange}})],1)],1)],1)],1),t("el-dialog",{attrs:{title:"选择加工批号","close-on-click-modal":!1,visible:e.showQrcodeTaskListDialog,"append-to-body":"",width:"80%"},on:{"update:visible":function(t){e.showQrcodeTaskListDialog=t}}},[t("qrcode-task-list",{attrs:{"production-id":e.production_id},on:{confirm:e.confirmSelectQrcodeTask}})],1)],1)},n=[],r=(i("28a5"),i("decf")),o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"app-container"},[t("div",{staticClass:"filter-container"},[t("el-button",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"filter-item",attrs:{type:"warning",icon:"el-icon-refresh"},on:{click:e.handleFilter}},[e._v("刷新")])],1),t("el-table",{ref:"multipleTable",attrs:{border:"","highlight-current-row":"",data:e.tableList}},[t("el-table-column",{attrs:{align:"center",label:"ID",prop:"id",width:"100"}}),t("el-table-column",{attrs:{prop:"code",label:"加工批号"}}),t("el-table-column",{attrs:{prop:"production.name",label:"工厂"}}),t("el-table-column",{attrs:{prop:"good.name",label:"品规"}}),t("el-table-column",{attrs:{prop:"num",width:"100px",label:"生成数量"}}),t("el-table-column",{attrs:{prop:"name",label:"备注"}}),t("el-table-column",{attrs:{prop:"add_time",width:"200px",label:"创建时间"}}),t("el-table-column",{attrs:{label:"操作",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.confirmSelect(i.row)}}},[e._v("选择")])]}}])})],1),t("div",{staticClass:"pagination-container"},[t("el-pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],attrs:{background:"","current-page":e.page,"page-sizes":[10,15,20,50],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.pageSizeChange,"current-change":e.pageChange}})],1)],1)},s=[],c=(i("8e6e"),i("ac6a"),i("456d"),i("ade3"));i("c5f6");function l(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function d(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?l(Object(i),!0).forEach((function(t){Object(c["a"])(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var u={name:"QrcodeTaskList",props:{productionId:{type:[Number,String],default:0}},data:function(){return{page:1,pageSize:10,total:0,tableList:[],map:{},loading:!1}},created:function(){this.getList()},methods:{confirmSelect:function(e){this.$emit("confirm",e)},getList:function(){var e=this;this.loading=!0,this.$ajax.post("/api/qrcode/task",d({page:this.page,pageSize:this.pageSize,production_id:this.productionId},this.map)).then((function(t){e.loading=!1,e.tableList=t.data,e.total=t.total})).catch((function(){e.loading=!1}))},pageSizeChange:function(e){this.pageSize=e,this.getList()},pageChange:function(e){this.page=e,this.getList()},handleFilter:function(){this.page=1,this.getList()}}},f=u,p=i("2877"),h=Object(p["a"])(f,o,s,!1,null,"1561b9e6",null),g=h.exports,m={name:"BatchQrcode",components:{Upload:r["a"],QrcodeTaskList:g},data:function(){return{production_id:0,batch_id:"",code:"",qrcode:"",loading:!1,showQrcodeTaskListDialog:!1}},created:function(){this.code=this.$route.query.code,this.batch_id=this.$route.query.batch_id,this.production_id=this.$route.query.production_id},mounted:function(){this.qrcodeFocus()},methods:{confirmSelectQrcodeTask:function(e){var t=this;this.showQrcodeTaskListDialog=!1,this.$confirm("加工批号内所有二维码将入库至批号内, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.doSetQrcodeTask(e)}))},doSetQrcodeTask:function(e){var t=this;this.loading||(this.loading=!0,this.$ajax.post("/api/batch/addQrcodeByQrcodetask",{batch_id:this.batch_id,code:this.code,task_id:e.id}).then((function(){t.$notify({title:"成功",message:"操作成功",type:"success",duration:2e3})})).finally((function(){t.loading=!1})))},fileChange:function(e,t,i,a){200==a.code?this.$notify({title:"成功",message:"上传成功",type:"success",duration:2e3}):this.$message.error({message:a.message,duration:1500})},formatQrcode:function(){var e=this.qrcode.split("/"),t=e[e.length-1];return t},addQrcode:function(){var e=this;if(!this.loading){var t=this.formatQrcode();t?(this.loading=!0,this.$ajax.post("/api/batch/addQrcode",{code:this.code,qrcode:t,batch_id:this.batch_id}).then((function(t){e.$message.success({message:"扫码成功",duration:700}),e.qrcodeFocus()})).finally((function(t){e.qrcode="",e.loading=!1}))):this.$message.error({message:"请扫描二维码",duration:700})}},qrcodeChange:function(){this.addQrcode()},qrcodeBlur:function(){var e=this;setTimeout((function(){e.qrcodeFocus()}),300)},qrcodeFocus:function(){this.$refs.qrcodeRef.focus()}}},v=m,b=(i("7972"),Object(p["a"])(v,a,n,!1,null,"10fc45eb",null));t["default"]=b.exports},decf:function(e,t,i){"use strict";var a=function(){var e=this,t=e._self._c;return t("div",[t("el-upload",{ref:"uploadFile",attrs:{name:"file",drag:e.drag,action:e.actionUrl,headers:e.headers,accept:e.accept,multiple:e.multipleSelect,data:e.data,disabled:e.disabled,"show-file-list":!e.avatar,"list-type":e.listType,"file-list":e.fileList,"on-preview":e.filePreview,limit:e.limit,"on-error":e.handleError,"on-exceed":e.handleExceed,"on-success":e.handleSuccess,"on-remove":e.handleRemove,"before-upload":e.beforeUpload,"before-remove":e.beforeRemove}},[e._t("default",(function(){return[e.avatar?t("div",{staticClass:"avatar",style:"background-image: url("+e.imageUrl+")"}):t("div",[t("i",{staticClass:"el-icon-plus"}),t("p",{directives:[{name:"show",rawName:"v-show",value:e.drag,expression:"drag"}]},[e._v("拖拽或点击上传")])])]}))],2),t("el-dialog",{attrs:{visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1)},n=[],r=(i("8e6e"),i("ac6a"),i("456d"),i("9e1f"),i("450d"),i("6ed5")),o=i.n(r),s=(i("7f7f"),i("20d6"),i("ade3")),c=(i("c5f6"),i("0a5a")),l=i("4365"),d=i("2f62");function u(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function f(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?u(Object(i),!0).forEach((function(t){Object(s["a"])(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):u(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var p={name:"Upload",props:{limit:{type:Number,default:0},multiple:{type:Boolean,default:!0},action:{type:String,default:"/api/upload/file"},accept:{type:String,default:""},maxSize:{type:Number,default:52428800},fileList:{type:Array,default:function(){return[]}},avatar:{type:String,default:""},data:{type:Object,default:function(){return{}}},disabled:{type:Boolean,default:!1},imageCard:{type:Boolean,default:!1},drag:{type:Boolean,default:!1},showLoading:{type:Boolean,default:!1}},watch:{avatar:function(e){this.imageUrl=e},fileList:function(e){this.fileUploadList=e}},created:function(){this.imageUrl=this.avatar},computed:{actionUrl:function(){return l["a"]+this.action},listType:function(){return this.accept.indexOf("image")>=0?this.imageCard?"picture":"picture-card":"text"},multipleSelect:function(){return this.multiple&&1!==this.limit}},data:function(){return{imageUrl:"",dialogImageUrl:"",dialogVisible:!1,noRemoveNotice:!1,headers:{token:Object(c["a"])()},fileUploadList:[],fileIds:[],loadingId:""}},methods:f(f({},Object(d["b"])(["FedLogOut"])),{},{clearFile:function(){this.$refs.uploadFile.clearFiles(),this.fileUploadList=[]},filePreview:function(e){var t=e.type;t&&t.indexOf("image")>=0&&(this.dialogImageUrl=e.url,this.dialogVisible=!0)},beforeUpload:function(e){var t=this.fileUploadList.findIndex((function(t){return t.name===e.name&&t.size===e.size&&t.type===e.type}));return t>=0?(this.noRemoveNotice=!0,this.$message.error("图片已上传"),!1):"image/*"===this.accept&&e.type.indexOf("image")<0?(this.noRemoveNotice=!0,this.$message.error("图片格式错误"),!1):e.size>=this.maxSize?(this.noRemoveNotice=!0,this.$message.error("文件大小必须10M以内"),!1):(this.showLoading&&(this.loadingId=this.$loading({lock:!0,text:"上传中...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"})),!0)},handleSuccess:function(e,t,i){var a=this;if(401!==e.code){200===e.code?(e.data&&e.data.url&&(t.name=e.data.name,t.url=e.data.url,t.path=e.data.path,t.size=e.data.size,t.type=e.data.type,this.fileUploadList.push(t),this.imageUrl=e.data.url),this.handleChange(t,i,e)):(this.fileList.splice(-1),this.$message.error(e.message));try{this.loadingId&&(this.loadingId.close(),this.loadingId="")}catch(n){}}else o.a.confirm("你已被登出，可以取消继续留在该页面，或者重新登录","确定登出",{confirmButtonText:"重新登录",cancelButtonText:"取消",type:"warning"}).then((function(){a.FedLogOut().then((function(){location.reload()}))}))},beforeRemove:function(e){return!this.avatar&&(this.noRemoveNotice?(this.noRemoveNotice=!1,!0):this.$confirm("确定移除 ".concat(e.name,"？")))},handleRemove:function(e,t){this.imageUrl="";var i=this.fileUploadList.findIndex((function(t){return t.uid===e.uid}));i>=0&&this.fileUploadList.splice(i,1),this.handleChange(e,t)},handleExceed:function(e,t){this.$message.warning("当前限制选择 ".concat(this.limit," 个文件，本次选择了 ").concat(e.length," 个文件，共选择了 ").concat(e.length+t.length," 个文件"))},handleError:function(e){this.$message.error(e.message||"上传错误")},handleChange:function(e,t,i){var a=this.getList(t);this.$emit("on-change",{file_id:e.file_id,name:e.name,url:e.url,path:e.path,size:e.size,type:e.type},a,this.fileIds,i),1===this.limit&&this.clearFile()},getList:function(e){var t=this;return this.fileIds=[],e.map((function(e){return t.fileIds.push(e.file_id),{id:e.id,file_id:e.file_id,name:e.name,url:e.url,path:e.path,size:e.size,type:e.type}}))}})},h=p,g=(i("321f"),i("2877")),m=Object(g["a"])(h,a,n,!1,null,"e38f2b18",null);t["a"]=m.exports},e853:function(e,t,i){var a=i("d3f4"),n=i("1169"),r=i("2b4c")("species");e.exports=function(e){var t;return n(e)&&(t=e.constructor,"function"!=typeof t||t!==Array&&!n(t.prototype)||(t=void 0),a(t)&&(t=t[r],null===t&&(t=void 0))),void 0===t?Array:t}},fdef:function(e,t){e.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},ffcd:function(e,t,i){}}]);