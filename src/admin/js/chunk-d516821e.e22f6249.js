(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d516821e"],{"4b91":function(t,e,i){},"4da1":function(t,e,i){"use strict";i.r(e);i("7f7f");var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"app-container"},[e("div",{staticClass:"filter-container"},[t.permission.create?e("el-dropdown",{staticClass:"filter-item",attrs:{trigger:"click",disabled:t.loading},on:{command:t.handleCreate}},[e("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{type:"primary"}},[t._v("\n        添加"),e("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("el-dropdown-item",{attrs:{command:0}},[t._v("添加")]),e("el-dropdown-item",{attrs:{command:1}},[t._v("批量导入")])],1)],1):t._e(),e("el-input",{staticClass:"filter-item",staticStyle:{width:"200px"},attrs:{clearable:"",placeholder:"编号"},model:{value:t.map.code,callback:function(e){t.$set(t.map,"code",e)},expression:"map.code"}}),e("el-input",{staticClass:"filter-item",staticStyle:{width:"200px"},attrs:{clearable:"",placeholder:"名称"},model:{value:t.map.name,callback:function(e){t.$set(t.map,"name",e)},expression:"map.name"}}),e("el-select",{staticClass:"filter-item",attrs:{clearable:"",placeholder:"状态"},model:{value:t.map.status,callback:function(e){t.$set(t.map,"status",e)},expression:"map.status"}},t._l(t.statusList,(function(t,i){return e("el-option",{key:i,attrs:{label:t.label,value:t.value}})})),1),e("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.handleFilter}},[t._v("搜索")]),e("el-dropdown",{staticClass:"filter-item",attrs:{trigger:"click",disabled:t.exportLoading},on:{command:t.exportExcel}},[e("el-button",{attrs:{type:"primary"}},[t._v("\n        导出"),e("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("el-dropdown-item",{attrs:{command:0}},[t._v("导出本页")]),e("el-dropdown-item",{attrs:{command:1}},[t._v("导出全部")])],1)],1)],1),e("el-table",{attrs:{border:"","highlight-current-row":"",data:t.tableList}},[e("el-table-column",{attrs:{align:"center",label:"ID",prop:"id",width:"100"}}),e("el-table-column",{attrs:{prop:"code",label:"工厂编号"}}),e("el-table-column",{attrs:{prop:"name",label:"工厂名称"}}),e("el-table-column",{attrs:{prop:"factory.name",label:"附属基地"}}),e("el-table-column",{attrs:{prop:"batch_count",label:"批号数量"},scopedSlots:t._u([{key:"default",fn:function(i){return[t._v("\n        "+t._s(i.row.batch_count)+" \n        "),i.row.batch_count>0?e("el-button",{staticStyle:{"margin-left":"3px"},attrs:{type:"text"},on:{click:function(e){t.itemId=i.row.id,t.batchDialogVisible=!0}}},[t._v("查看")]):t._e()]}}])}),e("el-table-column",{attrs:{prop:"linkman",label:"联系人"}}),e("el-table-column",{attrs:{prop:"tel",label:"联系电话"}}),e("el-table-column",{attrs:{prop:"address",label:"联系地址"}}),e("el-table-column",{attrs:{prop:"create_time",label:"创建时间"}}),e("el-table-column",{attrs:{prop:"status_name",label:"状态"}}),t.permission.statistic?e("el-table-column",{attrs:{prop:"batch_count",label:"统计信息",width:"80"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.showStatisticInfo(i.row.id)}}},[t._v("查看")])]}}],null,!1,1890200231)}):t._e(),e("el-table-column",{attrs:{label:"操作",width:"200px"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("el-button-group",[t.permission.admin?e("el-button",{attrs:{type:"success",size:"small"},on:{click:function(e){return t.handleAdmin(i.row)}}},[t._v("账户")]):t._e(),t.permission.edit?e("el-button",{attrs:{type:"warning",size:"small"},on:{click:function(e){return t.handleEdit(i.row)}}},[t._v("编辑")]):t._e(),t.permission.delete?e("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(e){return t.deleteItem(i.row.id)}}},[t._v("删除")]):t._e()],1)]}}])})],1),e("div",{staticClass:"pagination-container"},[e("el-pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total > 0"}],attrs:{background:"","current-page":t.page,"page-sizes":[10,15,20,50],"page-size":t.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.pageSizeChange,"current-change":t.pageChange}})],1),e("m-dialog",{attrs:{title:"添加工厂",visible:t.addDialogVisible},on:{"update:visible":function(e){t.addDialogVisible=e}}},[e("el-form",{ref:"newItem",attrs:{model:t.newItem,rules:t.newItemRules,"label-width":"100px"}},[e("el-form-item",{attrs:{label:"繁育基地",prop:"factory_id"}},[e("el-select",{attrs:{placeholder:"请选择附属基地"},model:{value:t.newItem.factory_id,callback:function(e){t.$set(t.newItem,"factory_id",e)},expression:"newItem.factory_id"}},t._l(t.factoryList,(function(t){return e("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),e("el-form-item",{attrs:{label:"工厂编号",prop:"code"}},[e("el-input",{attrs:{type:"text",autocomplete:"off",placeholder:"工厂编号添加后不可修改"},model:{value:t.newItem.code,callback:function(e){t.$set(t.newItem,"code",e)},expression:"newItem.code"}})],1),e("el-form-item",{attrs:{label:"工厂名称",prop:"name"}},[e("el-input",{attrs:{type:"text",autocomplete:"off"},model:{value:t.newItem.name,callback:function(e){t.$set(t.newItem,"name",e)},expression:"newItem.name"}})],1),e("el-form-item",{attrs:{label:"联系人",prop:"linkman"}},[e("el-input",{attrs:{type:"text",autocomplete:"off"},model:{value:t.newItem.linkman,callback:function(e){t.$set(t.newItem,"linkman",e)},expression:"newItem.linkman"}})],1),e("el-form-item",{attrs:{label:"联系电话",prop:"tel"}},[e("el-input",{attrs:{type:"text",autocomplete:"off"},model:{value:t.newItem.tel,callback:function(e){t.$set(t.newItem,"tel",e)},expression:"newItem.tel"}})],1),e("el-form-item",{attrs:{label:"联系地址",prop:"address"}},[e("el-input",{attrs:{type:"text",autocomplete:"off"},model:{value:t.newItem.address,callback:function(e){t.$set(t.newItem,"address",e)},expression:"newItem.address"}})],1),e("el-form-item",{attrs:{label:"状态",prop:"status"}},[e("el-radio-group",{model:{value:t.newItem.status,callback:function(e){t.$set(t.newItem,"status",e)},expression:"newItem.status"}},[e("el-radio",{attrs:{label:1}},[t._v("上架")]),e("el-radio",{attrs:{label:0}},[t._v("下架")])],1)],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.addDialogVisible=!1}}},[t._v("取 消")]),e("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{type:"primary"},on:{click:t.confirmCreateItem}},[t._v("确 定")])],1)],1),e("m-dialog",{attrs:{title:"批量导入",visible:t.addMutilDialogVisible,width:"400px"},on:{"update:visible":function(e){t.addMutilDialogVisible=e}}},[t.addMutilDialogVisible?e("import-excel",{on:{success:t.getList}}):t._e()],1),e("m-dialog",{attrs:{title:"账户管理",visible:t.adminDialogVisible},on:{"update:visible":function(e){t.adminDialogVisible=e}}},[t.adminDialogVisible?e("m-admin",{attrs:{api:t.adminApi}}):t._e()],1),e("m-dialog",{attrs:{title:"批号管理",visible:t.batchDialogVisible},on:{"update:visible":function(e){t.batchDialogVisible=e}}},[t.batchDialogVisible?e("batch-temp",{attrs:{"production-id":t.itemId,api:t.adminApi}}):t._e()],1),e("m-dialog",{attrs:{title:"统计信息",visible:t.showStatisticDialog},on:{"update:visible":function(e){t.showStatisticDialog=e}}},[t.showStatisticDialog?e("statistic-info",{attrs:{"production-id":t.itemId}}):t._e()],1)],1)},n=[],o=(i("8e6e"),i("ac6a"),i("456d"),i("ade3")),l=i("0e0b"),s=i("20c2"),r=i("7f19"),c=function(){var t=this,e=t._self._c;return e("div",{staticStyle:{"text-align":"center"}},[e("div",[t._v("\n    请先"),e("el-button",{attrs:{type:"text"},on:{click:t.downloadExcelTemplate}},[t._v("下载模板")]),t._v(",填写后上传!\n  ")],1),e("div",[e("upload",{attrs:{disabled:t.loading,drag:"",accept:".xlsx,.xls"},on:{"on-change":t.changeHandle}})],1)])},d=[],u=i("decf"),p=i("7a8c"),m={name:"ProductionImportExcel",components:{Upload:u["a"]},data:function(){return{loading:!1}},methods:{changeHandle:function(t){var e=this;this.loading||(this.loading=!0,this.$ajax.post("/api/production/importExcel",{path:t.path}).then((function(t){e.$notify({title:"成功",message:"导入成功："+t.count+"条",type:"success",duration:2e3}),e.$emit("success")})).finally((function(){e.loading=!1})))},downloadExcelTemplate:function(){Object(p["a"])({url:"/api/production/downloadExcelTemplate",name:"工厂批量导入模板.xlsx"})}}},f=m,g=i("2877"),h=Object(g["a"])(f,c,d,!1,null,null,null),b=h.exports,w=function(){var t=this,e=t._self._c;return e("div",[e("el-row",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{gutter:20}},t._l(t.st,(function(t,i){return e("el-col",{key:i,staticStyle:{"margin-bottom":"40px"},attrs:{span:6}},[e("el-statistic",{attrs:{"group-separator":",",value:t.value,title:t.name}})],1)})),1)],1)},v=[],y=(i("c5f6"),{props:{productionId:{type:[Number,String],default:""}},data:function(){return{loading:!1,st:[]}},created:function(){this.getStatistic()},methods:{getStatistic:function(){var t=this;this.loading=!0,this.$ajax.post("/api/statistic/production",{id:this.productionId}).then((function(e){t.st=e})).finally((function(){t.loading=!1}))}}}),x=y,_=Object(g["a"])(x,w,v,!1,null,null,null),I=_.exports;function k(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,a)}return i}function D(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?k(Object(i),!0).forEach((function(e){Object(o["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):k(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var S={name:"ProductionIndex",components:{MAdmin:s["a"],BatchTemp:r["default"],StatisticInfo:I,ImportExcel:b},data:function(){return{permission:{create:this.$checkAuth("ProductionCreate"),edit:this.$checkAuth("ProductionEdit"),delete:this.$checkAuth("ProductionDelete"),admin:this.$checkAuth("ProductionAdmin"),statistic:this.$checkAuth("ProductionStatistic")},page:1,pageSize:10,total:0,tableList:[],map:{},loading:!1,exportLoading:!1,addDialogVisible:!1,addMutilDialogVisible:!1,areaDialogVisible:!1,adminDialogVisible:!1,batchDialogVisible:!1,itemId:"",newItem:{factory_id:"",code:"",name:"",linkman:"",tel:"",address:"",status:1},newItemRules:{factory_id:[{required:!0,message:"请选择附属基地"}],code:[{required:!0,message:"请输入工厂编号"}],name:[{required:!0,message:"请输入工厂名称"}],linkman:[{required:!0,message:"请输入联系人"}],tel:[{required:!0,message:"请输入联系电话"}]},statusList:[{label:"上架",value:"1"},{label:"下架",value:"0"}],adminApi:{},factoryList:[],showStatisticDialog:!1}},created:function(){this.getList()},methods:{showStatisticInfo:function(t){this.itemId=t,this.showStatisticDialog=!0},handleAdmin:function(t){this.adminApi={list:"/api/production/users/production_id/"+t.id,add:"/api/production/userAdd/production_id/"+t.id,update:"/api/production/userUpdate/production_id/"+t.id,delete:"/api/production/userDelete/production_id/"+t.id},this.adminDialogVisible=!0},getFactoryList:function(){var t=this;this.$ajax.post("/api/factory/index",{pageSize:1e3}).then((function(e){t.factoryList=e.data}))},handleCreate:function(t){0!==t?this.addMutilDialogVisible=!0:this.showCreateDialog()},showCreateDialog:function(){this.newItem={factory_id:"",code:"",name:"",linkman:"",tel:"",address:"",status:1},0===this.factoryList.length&&this.getFactoryList(),this.addDialogVisible=!0},confirmCreateItem:function(){var t=this;this.$refs.newItem.validate((function(e){e&&(t.newItem.id?t.editItem():t.addItem())}))},handleEdit:function(t){0===this.factoryList.length&&this.getFactoryList(),this.newItem=t,this.addDialogVisible=!0},getList:function(){var t=this;this.loading=!0,this.$ajax.post("/api/production/index",D({page:this.page,pageSize:this.pageSize},this.map)).then((function(e){t.loading=!1,t.tableList=e.data,t.total=e.total})).catch((function(){t.loading=!1}))},pageSizeChange:function(t){this.pageSize=t,this.getList()},pageChange:function(t){this.page=t,this.getList()},handleFilter:function(){this.page=1,this.getList()},deleteItem:function(t){var e=this;this.$confirm("此操作将永久删除该工厂, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.loading||(e.loading=!0,e.$ajax.post("/api/production/delete/id/"+t).then((function(t){e.$notify({title:"成功",message:"删除成功",type:"success",duration:2e3}),e.getList()})).finally((function(){e.loading=!1})))}))},editItem:function(){var t=this;this.loading||(this.loading=!0,this.$ajax.post("/api/production/update/id/"+this.newItem.id,this.newItem).then((function(e){t.$notify({title:"成功",message:"编辑成功",type:"success",duration:2e3}),t.addDialogVisible=!1,t.getList()})).finally((function(){t.loading=!1})))},addItem:function(){var t=this;this.loading||(this.loading=!0,this.$ajax.post("/api/production/add",this.newItem).then((function(e){t.$notify({title:"成功",message:"添加成功",type:"success",duration:2e3}),t.addDialogVisible=!1,t.getList()})).finally((function(){t.loading=!1})))},exportExcel:function(t){var e=this;if(!this.exportLoading){this.exportLoading=!0;var i=1===t?"10000":this.pageSize,a=1===t?1:this.page;this.$ajax.post("/api/production/index",D({page:a,pageSize:i},this.map)).then((function(t){var i=["工厂编号","工厂名称","附属基地","批号数量","联系人","联系电话","联系地址","创建时间","状态"],a=t.data.map((function(t){return[t.code,t.name,t.factory?t.factory.name:"",t.batch_count,t.linkman,t.tel,t.address,t.create_time,t.status_name]}));Object(l["a"])({header:i,data:a,filename:"工厂信息"}).finally((function(){e.exportLoading=!1}))})).catch((function(){e.exportLoading=!1}))}}}},$=S,L=(i("6246"),Object(g["a"])($,a,n,!1,null,"9f00e59c",null));e["default"]=L.exports},6246:function(t,e,i){"use strict";i("4b91")}}]);